Author: DBQ(Du Baoqiang)
Blog: http://www.cnblogs.com/dubq/articles/5563802.html
Github: https://github.com/daniel-vv/stu177101

作业需求：
    模拟实现一个ATM + 购物商城程序
        1. 额度 15000或自定义
        2. 实现购物商城，买东西加入 购物车，调用信用卡接口结账
        3. 可以提现，手续费5%
        4. 每月22号出账单，每月10号为还款日，过期未还，按欠款总额 万分之5 每日计息
        5. 支持多账户登录
        6. 支持账户间转账
        7. 记录每月日常消费流水
        8. 提供还款接口
        9. ATM记录操作日志
        10. 提供管理接口，包括添加账户、用户额度，冻结账户等。。。

作业要求:
    分目录放文件: bin  conf  log   db  modules/core
	相对独立的功能，就尝试写成一个单独的文件；
	程序入口：
		atm.py start 开始进入程序
		shopping.py
			不写任何业务逻辑，全部在core/modules下
	conf:
		user_db
		全局变量
		log配置
	最低要求：
	账户信息用json或者pickle来存到文件中；

文件描述:
    文件夹/文件介绍:
        bin  执行程序目录,主程序执行入口目录
            atm.py          atm机主程序入口
            shopping.py     购物商城主程序入口
        conf 配置文件目录
            setting.py      配置文件,主要设置一些全局变量等
        core 接口程序目录
            atm_interface.py    ATM机程序目录,主要是各种函数,由主程序atm.py调用
            commodity_list.py   用户商城库文件,存放库里各种商品和价目信息
            log.py              日志定义文件,定义日志级别,输出数据流等
            menu.py             定义各级菜单显示信息,由其他接口程序调用
            shop_mall.py        购物商城程序,定义各种商城函数,支付,检查购物车,删除商品列表,查询商城消费记录等等
            user_manager.py     用户管理程序,里面定义各种用户操作函数,如删除,添加,解锁,注册,登录等等功能
        db  数据存放目录
            atm_lock.db         atm锁定用户文件,如果同一用户连续三次输入密码之后锁定,写入到此文件中,每一个用户一行
            atm_user.db         atm用户文件库文件,保存用户名密码,额度,可用额度
                此文件中是保存字典格式的字符串,通过序列化和反序列化操作(json)来加入到内存,而后引用到各个函数中.
                注意,里面字符串的引号务必是双引号!
                格式: {"用户名":{"用户名":"值","密码":"值","额度":50000,"可用额度":50000}
                    如: {"tom":{"username":"tom","password":"123","limit":50000,"available":50000}
                    值介绍如下:
                    available: 39101.0,      可用额度
                    "password: "9299805be3501d5be5e612cf9c012310",  md5加密过后的密码,并添加了一段字符串作为填充字符
                    "limit": 50000,          #信用额度
                    "username": "622202001", 卡号, 也是ATM普通用户唯一登录名
                    "record":{},       账单
                        record:{
                            '年-月-日': {total_debt:  档期欠款
                                        repayment:   还款金额
                                }
                            }
                        }
                    "user":"Tom",  用户名, 不能作为登录ATM使用!
                    "registry_date":"2016-06-05",   #注册日期
                    "expire_date":"2021-06-05"}     #过期日期
                    "freeze"    #是否为冻结用户

            shop_admin.db       商城管理员用户库文件
            shop_lock.db        商城锁定用户文件,如果同一用户连续三次输入密码错误之后会锁定,写入到此文件中,每一行一个.解锁需要管理员登录后台解锁.
            shop_user.db        商城用户数据库文件,存放用户账号,密码,邮箱,电话信息,格式:sam:sam:sam@gmail.com:18910002233,
                                注意末尾不能有空行,否则会注册后会报错.
            用户名文件           保存用户商城购买商品记录,通过pickle序列化和反序列化操作.每个用户一个.如tom,jerry
            db/atm/             保存了ATM商城的

        db/atm/用户卡号/record:
            存放用户消费记录, 每月的详单为  年月日, 如2016-6-22  ,如果7月为2016-7-22..
            根据系统时间判断,如果当前时间是23号之前(不含23号), 那么记录文件名字为当月的22文件内,如当前时间是2016-6-10,那么记录文件是: 2016-6-22
            如果当前时间大于等于23号,那么记录文件就是次月的了,如当前时间是2016-6-24, 那么记录文件是: 2016-7-22
            每个用户单独一个目录

        db/atm/admin_db.json:   ATM 管理员数据库文件
            {username: 用户名 , password: md5之后的密码, email: 联系邮箱, phone: 电话}
        logs    日志目录
            atm.log             ATM程序各个接口操作日志,如登录,交易,转账,等
            shop.log            商城操作日志,如增加用户,删除用户,登录,锁定,解锁用户等
        Readme                  自述文件
        atm_shopping.pdf        流程图


运行说明:
    本程序在 Mac下的PyCharm(5.0.3 Pro),以及Mac 终端(Python3.5解释器)中测试通过.
    执行方式: python3 /path/to/dirname/bin/atm.py        或者   进入bin目录./atm.py
             python3 /path/to/dirname/bin/shopping.py   或者   进入bin目录./shopping.py

             或者在Pycharm中运行两个主程序.


账户信息:
                        用户名
    默认商城管理员账号:    admin   密码: admin
       商城用户账号:      tom     密码: 123
                        jerry   密码: 123
    ATM用户账号:
                        622202001     密码: 123      初始额度: 50000   初始可用额度: 50000   提现金额: 不超过额度的50%
                        622202002     密码: 123      初始额度: 50000   初始可用额度: 50000   提现金额: 不超过额度的50%
    ATM管理员账号        admin   密码: admin
        关于管理员添加的用户:
            1. 自动生成9为数的随机数(只随机最后3位数), 前6为为 622202
            2. 每个用户默认有效期为5年
            3. 额度自定义

功能描述/思路整理:
    本程序首次采用了分目录模块之间互相调用的思想,所以在设计上难免存在不合理的地方,尤其是文件设计和全局变量引用上, 用了好多个全局变量,来判断
    用户身份以及其他信息的校验.如果再次做的话,肯定在设计上比此版本要好的多.

    用户商城在day4作业的基础上做了一些完善,包括删除购物车内容,查询用户购买历史记录,所有用户的购买记录都可以查询到,调用信用卡支付接口等.
        查询用户购买记录

    ATM这块有点复杂,尤其是还款和查询账单板块,总觉得不够完善.时间紧,先提交吧.有时间再完善.
    本想实现类似于招行信用卡的那种,还完了某期账单,也可以查看账单金额和是否还完账单,在字典里操作太不方便了,所以权衡之下,选择了还清账单后删除
    账单记录,而后变为在用户日志记录流水文件里体现还款是否还清等信息.
